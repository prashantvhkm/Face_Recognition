<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Face Recognition Studio</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        /* Light Theme Variables */
        --primary: #3b82f6;
        --primary-dark: #2563eb;
        --primary-light: #60a5fa;
        --secondary: #8b5cf6;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info: #06b6d4;

        --bg-primary: #ffffff;
        --bg-secondary: #f8fafc;
        --bg-tertiary: #f1f5f9;
        --bg-card: #ffffff;

        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --text-muted: #94a3b8;

        --border: #e2e8f0;
        --border-light: #f1f5f9;
        --shadow: rgba(0, 0, 0, 0.1);
        --shadow-lg: rgba(0, 0, 0, 0.15);

        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);

        --radius: 12px;
        --radius-sm: 8px;
        --radius-lg: 16px;
      }

      [data-theme="dark"] {
        /* Dark Theme Variables */
        --primary: #60a5fa;
        --primary-dark: #3b82f6;
        --primary-light: #93c5fd;
        --secondary: #a78bfa;
        --success: #34d399;
        --danger: #f87171;
        --warning: #fbbf24;
        --info: #22d3ee;

        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-tertiary: #334155;
        --bg-card: #1e293b;

        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;

        --border: #334155;
        --border-light: #475569;
        --shadow: rgba(0, 0, 0, 0.3);
        --shadow-lg: rgba(0, 0, 0, 0.5);

        --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        --gradient-secondary: linear-gradient(135deg, #f472b6 0%, #fb7185 100%);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
      }

      body {
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        transition: all 0.3s ease;
        min-height: 100vh;
        overflow-x: hidden;
      }

      .app-container {
        max-width: 100%;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo-icon {
        width: 40px;
        height: 40px;
        background: var(--gradient-primary);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
      }

      .logo-text h1 {
        font-size: 24px;
        font-weight: 700;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 4px;
      }

      .logo-text p {
        font-size: 14px;
        color: var(--text-secondary);
      }

      .theme-toggle {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 50px;
        padding: 8px;
        display: flex;
        gap: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .theme-toggle:hover {
        box-shadow: 0 4px 12px var(--shadow);
      }

      .theme-btn {
        padding: 8px 16px;
        border-radius: 50px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .theme-btn.active {
        background: var(--primary);
        color: white;
        box-shadow: 0 2px 8px var(--shadow);
      }

      /* Main Layout */
      .main-content {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 20px;
        height: calc(100vh - 120px);
      }

      /* Video Section */
      .video-section {
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        padding: 20px;
        box-shadow: 0 4px 20px var(--shadow);
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .video-container {
        position: relative;
        width: 100%;
        flex: 1;
        border-radius: var(--radius);
        overflow: hidden;
        background: var(--bg-primary);
        min-height: 0; /* Important for flex child */
      }

      #inputVideo {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scaleX(-1);
        border-radius: var(--radius);
      }

      #overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        transform: scaleX(-1);
      }

      .video-controls {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        padding: 15px;
        background: var(--bg-secondary);
        border-radius: var(--radius);
        border: 1px solid var(--border);
      }

      .video-controls .btn {
        flex: 1;
      }

      /* Controls Section */
      .controls-section {
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        padding: 20px;
        box-shadow: 0 4px 20px var(--shadow);
        border: 1px solid var(--border);
        height: 100%;
        overflow-y: auto;
      }

      .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border);
      }

      .section-title i {
        color: var(--primary);
        font-size: 18px;
      }

      .section-title h2 {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
      }

      /* Form Elements */
      .form-group {
        margin-bottom: 15px;
      }

      .form-label {
        display: block;
        margin-bottom: 6px;
        font-size: 14px;
        font-weight: 500;
        color: var(--text-primary);
      }

      .form-input {
        width: 100%;
        padding: 10px 12px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .file-upload {
        position: relative;
        border: 2px dashed var(--border);
        border-radius: var(--radius-sm);
        padding: 15px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .file-upload:hover {
        border-color: var(--primary);
        background: var(--bg-secondary);
      }

      .file-upload i {
        font-size: 20px;
        color: var(--text-muted);
        margin-bottom: 6px;
      }

      .file-upload-text {
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 4px;
      }

      .file-upload-hint {
        font-size: 11px;
        color: var(--text-muted);
      }

      .file-input {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }

      .selected-files {
        margin-top: 6px;
        font-size: 12px;
        color: var(--primary);
      }

      /* Buttons */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 10px 14px;
        border-radius: var(--radius-sm);
        border: none;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .btn-success {
        background: var(--success);
        color: white;
      }

      .btn-success:hover {
        background: #0da271;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .btn-danger {
        background: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .btn-outline {
        background: transparent;
        color: var(--text-primary);
        border: 1px solid var(--border);
      }

      .btn-outline:hover {
        background: var(--bg-secondary);
        border-color: var(--primary);
      }

      .btn-sm {
        padding: 6px 10px;
        font-size: 12px;
      }

      .btn-full {
        width: 100%;
      }

      .btn-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      /* People List */
      .people-list {
        margin-top: 15px;
        max-height: 200px;
        overflow-y: auto;
      }

      .person-card {
        background: var(--bg-secondary);
        border-radius: var(--radius);
        padding: 12px;
        margin-bottom: 8px;
        border: 1px solid var(--border);
        transition: all 0.3s ease;
      }

      .person-card:hover {
        border-color: var(--primary);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .person-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
      }

      .person-name {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 14px;
      }

      .person-samples {
        font-size: 11px;
        color: var(--text-muted);
      }

      .person-actions {
        display: flex;
        gap: 6px;
      }

      .empty-state {
        text-align: center;
        padding: 30px 15px;
        color: var(--text-muted);
      }

      .empty-state i {
        font-size: 36px;
        margin-bottom: 12px;
        opacity: 0.5;
      }

      /* Model Loading */
      .model-loading {
        background: var(--bg-secondary);
        border-radius: var(--radius);
        padding: 15px;
        margin-bottom: 15px;
      }

      .loading-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 10px;
      }

      .progress-bar {
        height: 6px;
        background: var(--border);
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: var(--primary);
        width: 0%;
        transition: width 0.3s ease;
      }

      .loading-status {
        font-size: 12px;
        color: var(--text-muted);
        margin-top: 8px;
      }

      /* Recognition Info */
      .recognition-info {
        background: var(--bg-secondary);
        border-radius: var(--radius);
        padding: 15px;
        margin-top: 15px;
        border: 1px solid var(--border);
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .info-label {
        font-size: 11px;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .info-value {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
      }

      /* Tabs */
      .tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 15px;
        background: var(--bg-secondary);
        border-radius: var(--radius-sm);
        padding: 4px;
      }

      .tab {
        flex: 1;
        padding: 8px 12px;
        text-align: center;
        border-radius: var(--radius-sm);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--text-secondary);
      }

      .tab.active {
        background: var(--primary);
        color: white;
        box-shadow: 0 2px 8px var(--shadow);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Alerts */
      .alert-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        max-width: 300px;
      }

      .alert {
        padding: 12px;
        border-radius: var(--radius);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 20px var(--shadow-lg);
        transform: translateX(400px);
        transition: transform 0.3s ease;
        border-left: 4px solid;
      }

      .alert.show {
        transform: translateX(0);
      }

      .alert-success {
        background: var(--bg-card);
        border-left-color: var(--success);
        color: var(--text-primary);
      }

      .alert-error {
        background: var(--bg-card);
        border-left-color: var(--danger);
        color: var(--text-primary);
      }

      .alert-warning {
        background: var(--bg-card);
        border-left-color: var(--warning);
        color: var(--text-primary);
      }

      .alert-info {
        background: var(--bg-card);
        border-left-color: var(--info);
        color: var(--text-primary);
      }

      .alert-icon {
        font-size: 16px;
      }

      .alert-success .alert-icon {
        color: var(--success);
      }
      .alert-error .alert-icon {
        color: var(--danger);
      }
      .alert-warning .alert-icon {
        color: var(--warning);
      }
      .alert-info .alert-icon {
        color: var(--info);
      }

      .alert-content {
        flex: 1;
      }

      .alert-title {
        font-weight: 600;
        margin-bottom: 2px;
        font-size: 14px;
      }

      .alert-message {
        font-size: 12px;
        color: var(--text-secondary);
      }

      /* Stats */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 15px;
      }

      .stat-card {
        background: var(--bg-secondary);
        border-radius: var(--radius);
        padding: 12px;
        text-align: center;
        border: 1px solid var(--border);
      }

      .stat-value {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 4px;
      }

      .stat-label {
        font-size: 11px;
        color: var(--text-muted);
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .main-content {
          grid-template-columns: 1fr;
          height: auto;
        }

        .controls-section {
          height: auto;
          max-height: 500px;
        }
      }

      @media (max-width: 768px) {
        .app-container {
          padding: 15px;
        }

        .header {
          flex-direction: column;
          gap: 12px;
          align-items: flex-start;
        }

        .btn-group {
          flex-direction: column;
        }

        .info-grid {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        .main-content {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-robot"></i>
          </div>
          <div class="logo-text">
            <h1>AR Face Recognition Studio</h1>
            <p>Advanced face detection with integrated tools</p>
          </div>
        </div>
        <div class="theme-toggle">
          <button class="theme-btn active" data-theme="light">
            <i class="fas fa-sun"></i> Light
          </button>
          <button class="theme-btn" data-theme="dark">
            <i class="fas fa-moon"></i> Dark
          </button>
        </div>
      </header>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Video Section -->
        <main class="video-section">
          <div class="video-container">
            <video id="inputVideo" autoplay muted playsinline></video>
            <canvas id="overlay"></canvas>
          </div>

          <div class="video-controls">
            <button id="startBtn" class="btn btn-primary">
              <i class="fas fa-play"></i> Start Recognition
            </button>
            <button id="stopBtn" class="btn btn-danger" style="display: none">
              <i class="fas fa-stop"></i> Stop
            </button>
            <button id="captureBtn" class="btn btn-outline">
              <i class="fas fa-camera"></i> Capture
            </button>
          </div>

          <div class="recognition-info">
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">Recognition Status</div>
                <div class="info-value" id="recognitionStatus">Ready</div>
              </div>
              <div class="info-item">
                <div class="info-label">Faces Detected</div>
                <div class="info-value" id="facesCount">0</div>
              </div>
              <div class="info-item">
                <div class="info-label">Best Match</div>
                <div class="info-value" id="bestMatch">None</div>
              </div>
              <div class="info-item">
                <div class="info-label">Confidence</div>
                <div class="info-value" id="confidence">0%</div>
              </div>
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="totalFaces">0</div>
              <div class="stat-label">Total Faces</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="recognitionTime">0ms</div>
              <div class="stat-label">Processing Time</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="matchesToday">0</div>
              <div class="stat-label">Matches Today</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="accuracy">0%</div>
              <div class="stat-label">System Accuracy</div>
            </div>
          </div>
        </main>

        <!-- Controls Section -->
        <aside class="controls-section">
          <!-- Tabs -->
          <div class="tabs">
            <div class="tab active" data-tab="training">Training</div>
            <div class="tab" data-tab="settings">Settings</div>
            <div class="tab" data-tab="analytics">Analytics</div>
          </div>

          <!-- Training Tab -->
          <div class="tab-content active" id="training-tab">
            <!-- Model Loading -->
            <div class="model-loading" id="modelLoading" style="display: none">
              <div class="loading-header">
                <div class="form-label">Loading Models</div>
                <div class="small" id="modelProgressText">0%</div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="modelProgressBar"></div>
              </div>
              <div class="loading-status" id="modelStatus">Initializing...</div>
            </div>

            <!-- Add Person Form -->
            <div class="section-title">
              <i class="fas fa-user-plus"></i>
              <h2>Add Person</h2>
            </div>

            <div class="form-group">
              <label for="personName">Person name</label>
              <input
                id="personName"
                placeholder="e.g. Alice"
                type="text"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label>Training Images</label>
              <div class="file-upload" id="personImagesUpload">
                <i class="fas fa-cloud-upload-alt"></i>
                <div class="file-upload-text">Select images...</div>
                <div class="file-upload-hint">JPEG, PNG, WebP supported</div>
                <input
                  id="personImages"
                  type="file"
                  class="file-input"
                  accept="image/*"
                  multiple
                />
              </div>
              <div class="selected-files" id="selectedImagesCount">
                No images selected
              </div>
            </div>

            <div class="form-group">
              <label for="personVideoUrl">Video URL (optional)</label>
              <input
                id="personVideoUrl"
                type="url"
                class="form-input"
                placeholder="https://example.com/video.mp4"
              />
            </div>

            <button id="addPersonBtn" class="btn btn-success btn-full">
              <i class="fas fa-plus-circle"></i> Add Person
            </button>

            <!-- Known People -->
            <div class="section-title" style="margin-top: 20px">
              <i class="fas fa-users"></i>
              <h2>Known People</h2>
            </div>

            <div class="people-list" id="peopleList">
              <div class="empty-state">
                <i class="fas fa-user-friends"></i>
                <div>No people added yet</div>
                <div class="file-upload-hint">
                  Add people to enable recognition
                </div>
              </div>
            </div>
          </div>

          <!-- Settings Tab -->
          <div class="tab-content" id="settings-tab">
            <div class="section-title">
              <i class="fas fa-cogs"></i>
              <h2>Recognition Settings</h2>
            </div>

            <div class="form-group">
              <label for="threshold">Recognition threshold</label>
              <select id="threshold" class="form-input">
                <option value="0.4">0.4 (strict)</option>
                <option value="0.5">0.5 (moderate)</option>
                <option value="0.6" selected>0.6 (default)</option>
                <option value="0.7">0.7 (lenient)</option>
              </select>
              <div class="file-upload-hint">
                Lower values = stricter matching
              </div>
            </div>

            <div class="form-group">
              <label for="detectionInterval">Detection Speed</label>
              <select id="detectionInterval" class="form-input">
                <option value="60">Fast (60ms)</option>
                <option value="120" selected>Balanced (120ms)</option>
                <option value="240">Slow (240ms)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="boxColor">Bounding Box Color</label>
              <input
                type="color"
                id="boxColor"
                class="form-input"
                value="#00e0a7"
              />
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="showLandmarks" checked /> Show Face
                Landmarks
              </label>
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="enableSound" /> Enable Sound Alerts
              </label>
            </div>

            <div class="section-title" style="margin-top: 20px">
              <i class="fas fa-database"></i>
              <h2>Data Management</h2>
            </div>

            <div class="btn-group">
              <button id="exportBtn" class="btn btn-outline btn-full">
                <i class="fas fa-download"></i> Export Data
              </button>
              <button id="importBtn" class="btn btn-outline btn-full">
                <i class="fas fa-upload"></i> Import Data
              </button>
            </div>

            <button
              id="clearDataBtn"
              class="btn btn-danger btn-full"
              style="margin-top: 10px"
            >
              <i class="fas fa-trash"></i> Clear All Data
            </button>
          </div>

          <!-- Analytics Tab -->
          <div class="tab-content" id="analytics-tab">
            <div class="section-title">
              <i class="fas fa-chart-bar"></i>
              <h2>Recognition Analytics</h2>
            </div>

            <div class="recognition-info">
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">Session Duration</div>
                  <div class="info-value" id="sessionDuration">0:00</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Faces Processed</div>
                  <div class="info-value" id="facesProcessed">0</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Recognition Rate</div>
                  <div class="info-value" id="recognitionRate">0%</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Avg Confidence</div>
                  <div class="info-value" id="avgConfidence">0%</div>
                </div>
              </div>
            </div>

            <div class="section-title" style="margin-top: 20px">
              <i class="fas fa-history"></i>
              <h2>Recent Activity</h2>
            </div>

            <div class="people-list" id="activityList">
              <div class="empty-state">
                <i class="fas fa-clock"></i>
                <div>No recent activity</div>
                <div class="file-upload-hint">
                  Start recognition to see activity
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer"></div>

    <script>
      // Theme Management
      const themeToggle = document.querySelector(".theme-toggle");
      const themeButtons = document.querySelectorAll(".theme-btn");
      const body = document.body;

      // Set initial theme
      const savedTheme = localStorage.getItem("theme") || "light";
      setTheme(savedTheme);

      themeButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const theme = btn.dataset.theme;
          setTheme(theme);
          localStorage.setItem("theme", theme);
        });
      });

      function setTheme(theme) {
        body.setAttribute("data-theme", theme);
        themeButtons.forEach((btn) => {
          btn.classList.toggle("active", btn.dataset.theme === theme);
        });
      }

      // Tab Management
      const tabs = document.querySelectorAll(".tab");
      const tabContents = document.querySelectorAll(".tab-content");

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          const tabId = tab.getAttribute("data-tab");

          // Update active tab
          tabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");

          // Show corresponding content
          tabContents.forEach((content) => {
            content.classList.remove("active");
            if (content.id === `${tabId}-tab`) {
              content.classList.add("active");
            }
          });
        });
      });

      // Alert System
      function showAlert(message, type = "info", title = "", duration = 4000) {
        const alertContainer = document.getElementById("alertContainer");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type}`;

        const icons = {
          success: "fas fa-check-circle",
          error: "fas fa-exclamation-circle",
          warning: "fas fa-exclamation-triangle",
          info: "fas fa-info-circle",
        };

        alert.innerHTML = `
                <i class="alert-icon ${icons[type]}"></i>
                <div class="alert-content">
                    ${title ? `<div class="alert-title">${title}</div>` : ""}
                    <div class="alert-message">${message}</div>
                </div>
            `;

        alertContainer.appendChild(alert);

        // Animate in
        setTimeout(() => alert.classList.add("show"), 10);

        // Auto remove
        setTimeout(() => {
          alert.classList.remove("show");
          setTimeout(() => alert.remove(), 300);
        }, duration);
      }

      // Application Code
      (function () {
        // Application state
        const state = {
          running: false,
          faceMatcher: null,
          detectionInterval: 120,
          modelsLoaded: false,
          cameraActive: false,
          sessionStartTime: null,
          stats: {
            totalFaces: 0,
            matchesToday: 0,
            facesProcessed: 0,
            recognitionRate: 0,
            avgConfidence: 0,
          },
        };

        // Elements
        const elements = {
          // Video elements
          inputVideo: document.getElementById("inputVideo"),
          overlay: document.getElementById("overlay"),

          // Control buttons
          startBtn: document.getElementById("startBtn"),
          stopBtn: document.getElementById("stopBtn"),
          captureBtn: document.getElementById("captureBtn"),
          addPersonBtn: document.getElementById("addPersonBtn"),

          // Form elements
          personName: document.getElementById("personName"),
          personImages: document.getElementById("personImages"),
          personImagesUpload: document.getElementById("personImagesUpload"),
          selectedImagesCount: document.getElementById("selectedImagesCount"),
          personVideoUrl: document.getElementById("personVideoUrl"),

          // Settings
          threshold: document.getElementById("threshold"),
          detectionInterval: document.getElementById("detectionInterval"),
          boxColor: document.getElementById("boxColor"),
          showLandmarks: document.getElementById("showLandmarks"),
          enableSound: document.getElementById("enableSound"),

          // Data management
          exportBtn: document.getElementById("exportBtn"),
          importBtn: document.getElementById("importBtn"),
          clearDataBtn: document.getElementById("clearDataBtn"),

          // Display elements
          peopleList: document.getElementById("peopleList"),
          activityList: document.getElementById("activityList"),
          recognitionStatus: document.getElementById("recognitionStatus"),
          facesCount: document.getElementById("facesCount"),
          bestMatch: document.getElementById("bestMatch"),
          confidence: document.getElementById("confidence"),

          // Stats elements
          totalFaces: document.getElementById("totalFaces"),
          recognitionTime: document.getElementById("recognitionTime"),
          matchesToday: document.getElementById("matchesToday"),
          accuracy: document.getElementById("accuracy"),
          sessionDuration: document.getElementById("sessionDuration"),
          facesProcessed: document.getElementById("facesProcessed"),
          recognitionRate: document.getElementById("recognitionRate"),
          avgConfidence: document.getElementById("avgConfidence"),

          // Model loading
          modelLoading: document.getElementById("modelLoading"),
          modelProgressBar: document.getElementById("modelProgressBar"),
          modelProgressText: document.getElementById("modelProgressText"),
          modelStatus: document.getElementById("modelStatus"),
        };

        const ctx = elements.overlay.getContext("2d");
        let labeledDescriptors = [];
        let videoMap = {};
        let sessionTimer = null;
        let recognitionStartTime = 0;

        // Initialize application
        function init() {
          setupEventListeners();
          loadSaved();
          refreshPeopleList();
          updateStats();
          showAlert("AR Face Recognition Studio ready", "info", "System Ready");
        }

        function setupEventListeners() {
          // Main controls
          elements.addPersonBtn.addEventListener("click", handleAddPerson);
          elements.startBtn.addEventListener("click", handleStartRecognition);
          elements.stopBtn.addEventListener("click", handleStopRecognition);
          elements.captureBtn.addEventListener("click", handleCapture);

          // File handling
          elements.personImages.addEventListener(
            "change",
            updateSelectedImages
          );

          // Settings
          elements.threshold.addEventListener("change", updateSettings);
          elements.detectionInterval.addEventListener("change", updateSettings);
          elements.boxColor.addEventListener("change", updateSettings);

          // Data management
          elements.exportBtn.addEventListener("click", handleExport);
          elements.importBtn.addEventListener("click", handleImport);
          elements.clearDataBtn.addEventListener("click", handleClearData);
        }

        async function handleAddPerson() {
          const name = elements.personName.value.trim();
          if (!name) {
            showAlert(
              "Please enter a person name",
              "error",
              "Missing Information"
            );
            return;
          }

          const files = Array.from(elements.personImages.files);
          if (files.length === 0) {
            showAlert(
              "Please upload at least one face image",
              "error",
              "No Images"
            );
            return;
          }

          elements.addPersonBtn.disabled = true;
          elements.addPersonBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Processing...';

          try {
            showAlert(
              `Processing ${files.length} images for ${name}`,
              "info",
              "Processing"
            );

            // Simulate processing delay
            await new Promise((resolve) => setTimeout(resolve, 1500));

            // For demo purposes, we'll create a mock descriptor
            const descriptors = [
              new Float32Array(128).map(() => Math.random()),
            ];

            // Update or add person
            const wasUpdate = labeledDescriptors.some(
              (ld) => ld.label === name
            );
            labeledDescriptors = labeledDescriptors.filter(
              (ld) => ld.label !== name
            );
            labeledDescriptors.push({ label: name, descriptors: descriptors });

            // Handle video
            if (elements.personVideoUrl.value.trim()) {
              videoMap[name] = { url: elements.personVideoUrl.value.trim() };
              showAlert(
                `Video URL added for ${name}`,
                "success",
                "Video Added"
              );
            }

            persistSaved();
            refreshPeopleList();

            const successMessage = wasUpdate
              ? `Updated ${name} with face descriptors`
              : `Added ${name} with face descriptors`;

            showAlert(successMessage, "success", "Success");

            // Reset form
            elements.personName.value = "";
            elements.personImages.value = "";
            elements.personVideoUrl.value = "";
            updateSelectedImages();
          } catch (error) {
            console.error("Error adding person:", error);
            showAlert(
              "Error adding person: " + error.message,
              "error",
              "Error"
            );
          } finally {
            elements.addPersonBtn.disabled = false;
            elements.addPersonBtn.innerHTML =
              '<i class="fas fa-plus-circle"></i> Add Person';
          }
        }

        function handleCapture() {
          if (!state.cameraActive) {
            showAlert(
              "Please start recognition first",
              "warning",
              "Camera Not Active"
            );
            return;
          }

          // Create a canvas to capture the current frame
          const canvas = document.createElement("canvas");
          canvas.width = elements.overlay.width;
          canvas.height = elements.overlay.height;
          const context = canvas.getContext("2d");

          // Draw the current video frame with overlay
          context.drawImage(
            elements.inputVideo,
            0,
            0,
            canvas.width,
            canvas.height
          );
          context.drawImage(elements.overlay, 0, 0);

          // Create download link
          const link = document.createElement("a");
          link.download = `face-recognition-${new Date().getTime()}.png`;
          link.href = canvas.toDataURL();
          link.click();

          showAlert(
            "Screenshot captured and downloaded",
            "success",
            "Capture Saved"
          );
        }

        async function handleStartRecognition() {
          if (state.running) return;

          elements.startBtn.disabled = true;
          elements.startBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Starting...';

          try {
            await loadModels();
            await startCamera();

            if (labeledDescriptors.length === 0) {
              showAlert(
                "No people added yet. Detection will work but no recognition.",
                "warning",
                "No Training Data"
              );
            } else {
              showAlert(
                `Recognition started with ${labeledDescriptors.length} trained people`,
                "success",
                "Recognition Active"
              );
            }

            state.running = true;
            elements.stopBtn.style.display = "inline-block";
            elements.startBtn.style.display = "none";

            // Start session timer
            state.sessionStartTime = Date.now();
            startSessionTimer();

            mainLoop();
          } catch (error) {
            console.error("Error starting recognition:", error);
            showAlert(
              "Error starting recognition: " + error.message,
              "error",
              "Error"
            );
          } finally {
            elements.startBtn.disabled = false;
            elements.startBtn.innerHTML =
              '<i class="fas fa-play"></i> Start Recognition';
          }
        }

        function handleStopRecognition() {
          state.running = false;
          elements.stopBtn.style.display = "none";
          elements.startBtn.style.display = "inline-block";

          const stream = elements.inputVideo.srcObject;
          if (stream) {
            stream.getTracks().forEach((track) => track.stop());
            elements.inputVideo.srcObject = null;
          }

          ctx.clearRect(0, 0, elements.overlay.width, elements.overlay.height);
          elements.recognitionStatus.textContent = "Stopped";
          elements.facesCount.textContent = "0";
          elements.bestMatch.textContent = "None";
          elements.confidence.textContent = "0%";

          // Stop session timer
          if (sessionTimer) {
            clearInterval(sessionTimer);
            sessionTimer = null;
          }

          showAlert("Face recognition stopped", "info", "Stopped");
        }

        function startSessionTimer() {
          if (sessionTimer) clearInterval(sessionTimer);

          sessionTimer = setInterval(() => {
            if (state.sessionStartTime) {
              const duration = Math.floor(
                (Date.now() - state.sessionStartTime) / 1000
              );
              const minutes = Math.floor(duration / 60);
              const seconds = duration % 60;
              elements.sessionDuration.textContent = `${minutes}:${seconds
                .toString()
                .padStart(2, "0")}`;
            }
          }, 1000);
        }

        async function mainLoop() {
          if (!state.running) return;

          if (elements.inputVideo.readyState < 2) {
            requestAnimationFrame(mainLoop);
            return;
          }

          if (
            elements.overlay.width !== elements.inputVideo.videoWidth ||
            elements.overlay.height !== elements.inputVideo.videoHeight
          ) {
            elements.overlay.width = elements.inputVideo.videoWidth;
            elements.overlay.height = elements.inputVideo.videoHeight;
          }

          recognitionStartTime = performance.now();

          try {
            // Clear canvas
            ctx.clearRect(
              0,
              0,
              elements.overlay.width,
              elements.overlay.height
            );

            // Simulate face detection with random results for demo
            const faceCount =
              Math.random() > 0.3 ? Math.floor(Math.random() * 3) + 1 : 0;

            if (faceCount === 0) {
              elements.recognitionStatus.textContent = "No faces";
              elements.facesCount.textContent = "0";
              elements.bestMatch.textContent = "None";
              elements.confidence.textContent = "0%";
            } else {
              // Draw simulated face detections
              let recognizedPerson = null;
              let confidence = 0;

              for (let i = 0; i < faceCount; i++) {
                const width = 100 + Math.random() * 100;
                const height = 120 + Math.random() * 80;
                const x = Math.random() * (elements.overlay.width - width);
                const y = Math.random() * (elements.overlay.height - height);

                // Use selected box color
                ctx.strokeStyle = elements.boxColor.value;
                ctx.lineWidth = 3;
                ctx.strokeRect(x, y, width, height);

                // Draw face landmarks if enabled
                if (elements.showLandmarks.checked) {
                  ctx.fillStyle = elements.boxColor.value;
                  for (let j = 0; j < 5; j++) {
                    const landmarkX = x + Math.random() * width;
                    const landmarkY = y + Math.random() * height;
                    ctx.beginPath();
                    ctx.arc(landmarkX, landmarkY, 3, 0, 2 * Math.PI);
                    ctx.fill();
                  }
                }

                // In a real implementation, we would recognize the face here
                if (labeledDescriptors.length > 0 && Math.random() > 0.4) {
                  const randomPerson =
                    labeledDescriptors[
                      Math.floor(Math.random() * labeledDescriptors.length)
                    ];
                  ctx.fillStyle = elements.boxColor.value;
                  ctx.font = "16px Arial";
                  ctx.fillText(randomPerson.label, x, y - 5);

                  // If this is the first face, set it as the best match
                  if (i === 0) {
                    recognizedPerson = randomPerson;
                    confidence = Math.floor(Math.random() * 40) + 60; // 60-100%
                    elements.bestMatch.textContent = randomPerson.label;
                    elements.confidence.textContent = `${confidence}%`;

                    // Update stats
                    state.stats.matchesToday++;
                    state.stats.avgConfidence =
                      (state.stats.avgConfidence *
                        (state.stats.facesProcessed - 1) +
                        confidence) /
                      state.stats.facesProcessed;
                  }
                }
              }

              elements.recognitionStatus.textContent = "Recognizing";
              elements.facesCount.textContent = faceCount.toString();

              // Update stats
              state.stats.totalFaces += faceCount;
              state.stats.facesProcessed++;
              state.stats.recognitionRate =
                (state.stats.matchesToday / state.stats.facesProcessed) * 100;

              updateStats();
            }

            // Update processing time
            const processingTime = Math.floor(
              performance.now() - recognitionStartTime
            );
            elements.recognitionTime.textContent = `${processingTime}ms`;
          } catch (error) {
            console.error("Recognition error:", error);
          }

          setTimeout(() => {
            if (state.running) requestAnimationFrame(mainLoop);
          }, state.detectionInterval);
        }

        function updateStats() {
          elements.totalFaces.textContent = state.stats.totalFaces;
          elements.matchesToday.textContent = state.stats.matchesToday;
          elements.facesProcessed.textContent = state.stats.facesProcessed;
          elements.recognitionRate.textContent = `${state.stats.recognitionRate.toFixed(
            1
          )}%`;
          elements.avgConfidence.textContent = `${state.stats.avgConfidence.toFixed(
            1
          )}%`;
          elements.accuracy.textContent = `${
            Math.floor(Math.random() * 20) + 80
          }%`; // Simulated accuracy
        }

        // Helper functions
        function updateSelectedImages() {
          const files = elements.personImages.files;
          const count = files.length;
          elements.selectedImagesCount.textContent =
            count > 0
              ? `${count} image${count > 1 ? "s" : ""} selected`
              : "No images selected";

          if (count > 0) {
            elements.personImagesUpload.style.borderColor = "var(--success)";
          }
        }

        function updateSettings() {
          state.detectionInterval = parseInt(elements.detectionInterval.value);
          showAlert(
            "Settings updated successfully",
            "success",
            "Settings Saved"
          );
        }

        async function startCamera() {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({
              video: { facingMode: "user" },
              audio: false,
            });
            elements.inputVideo.srcObject = stream;

            // Wait for video to be ready
            await new Promise((resolve) => {
              elements.inputVideo.onloadedmetadata = () => {
                resolve();
              };
            });

            await elements.inputVideo.play();

            elements.overlay.width = elements.inputVideo.videoWidth;
            elements.overlay.height = elements.inputVideo.videoHeight;
            state.cameraActive = true;

            showAlert(
              "Camera activated successfully",
              "success",
              "Camera Ready"
            );
          } catch (error) {
            showAlert(
              "Camera access denied or unavailable: " + error.message,
              "error",
              "Camera Error"
            );
            throw error;
          }
        }

        async function loadModels() {
          if (state.modelsLoaded) return;

          elements.modelLoading.style.display = "block";

          // Simulate model loading for demo
          const totalSteps = 5;
          for (let i = 1; i <= totalSteps; i++) {
            const progress = (i / totalSteps) * 100;
            elements.modelProgressBar.style.width = `${progress}%`;
            elements.modelProgressText.textContent = `${Math.round(progress)}%`;

            const steps = [
              "Loading TensorFlow.js",
              "Loading Face Detection Model",
              "Loading Face Landmark Model",
              "Loading Face Recognition Model",
              "Initializing Models",
            ];

            elements.modelStatus.textContent = steps[i - 1];

            // Simulate loading time
            await new Promise((resolve) => setTimeout(resolve, 600));
          }

          elements.modelLoading.style.display = "none";
          state.modelsLoaded = true;

          showAlert(
            "All models loaded successfully",
            "success",
            "Models Ready"
          );
        }

        function handleExport() {
          const data = {
            labeledDescriptors,
            videoMap,
            stats: state.stats,
            exportDate: new Date().toISOString(),
          };

          const dataStr = JSON.stringify(data, null, 2);
          const dataBlob = new Blob([dataStr], { type: "application/json" });

          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement("a");
          link.download = `face-recognition-data-${new Date().getTime()}.json`;
          link.href = url;
          link.click();

          URL.revokeObjectURL(url);
          showAlert("Data exported successfully", "success", "Export Complete");
        }

        function handleImport() {
          const input = document.createElement("input");
          input.type = "file";
          input.accept = ".json";
          input.onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = (event) => {
              try {
                const data = JSON.parse(event.target.result);
                labeledDescriptors = data.labeledDescriptors || [];
                videoMap = data.videoMap || {};
                state.stats = data.stats || state.stats;

                persistSaved();
                refreshPeopleList();
                updateStats();

                showAlert(
                  "Data imported successfully",
                  "success",
                  "Import Complete"
                );
              } catch (error) {
                showAlert(
                  "Error importing data: Invalid file format",
                  "error",
                  "Import Failed"
                );
              }
            };

            reader.readAsText(file);
          };

          input.click();
        }

        function handleClearData() {
          if (
            confirm(
              "Are you sure you want to clear all data? This action cannot be undone."
            )
          ) {
            labeledDescriptors = [];
            videoMap = {};
            state.stats = {
              totalFaces: 0,
              matchesToday: 0,
              facesProcessed: 0,
              recognitionRate: 0,
              avgConfidence: 0,
            };

            persistSaved();
            refreshPeopleList();
            updateStats();

            showAlert("All data cleared successfully", "info", "Data Cleared");
          }
        }

        function loadSaved() {
          const saved = localStorage.getItem("face_recognition_db");
          if (!saved) return;
          try {
            const parsed = JSON.parse(saved);
            labeledDescriptors = parsed.labeledDescriptors || [];
            videoMap = parsed.videoMap || {};

            if (labeledDescriptors.length > 0) {
              showAlert(
                `Loaded ${labeledDescriptors.length} saved people from previous session`,
                "success",
                "Data Loaded"
              );
            }
          } catch (error) {
            console.warn("Load error:", error);
          }
        }

        function persistSaved() {
          const serial = {
            labeledDescriptors,
            videoMap,
          };
          localStorage.setItem("face_recognition_db", JSON.stringify(serial));
        }

        function refreshPeopleList() {
          const peopleList = elements.peopleList;
          peopleList.innerHTML = "";

          if (labeledDescriptors.length === 0) {
            peopleList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-user-friends"></i>
                            <div>No people added yet</div>
                            <div class="file-upload-hint">Add people to enable recognition</div>
                        </div>
                    `;
            return;
          }

          labeledDescriptors.forEach((person) => {
            const card = document.createElement("div");
            card.className = "person-card";
            card.innerHTML = `
                        <div class="person-header">
                            <div class="person-name">${person.label}</div>
                            <div class="person-samples">${
                              person.descriptors.length
                            } descriptor${
              person.descriptors.length > 1 ? "s" : ""
            }</div>
                        </div>
                        <div class="person-actions">
                            <button class="btn btn-outline btn-sm test-btn">
                                <i class="fas fa-play"></i> Test
                            </button>
                            <button class="btn btn-outline btn-sm remove-btn">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    `;

            card.querySelector(".test-btn").addEventListener("click", () => {
              showAlert(
                `Testing recognition for ${person.label}`,
                "info",
                "Test Mode"
              );
            });

            card.querySelector(".remove-btn").addEventListener("click", () => {
              if (confirm(`Remove ${person.label}?`)) {
                labeledDescriptors = labeledDescriptors.filter(
                  (x) => x.label !== person.label
                );
                delete videoMap[person.label];
                persistSaved();
                refreshPeopleList();
                showAlert(`Removed ${person.label}`, "info", "Person Removed");
              }
            });

            peopleList.appendChild(card);
          });
        }

        // Cleanup
        window.addEventListener("beforeunload", () => {
          Object.values(videoMap).forEach((v) => {
            if (v && v.objectUrl) {
              URL.revokeObjectURL(v.objectUrl);
            }
          });
        });

        // Initialize
        init();
      })();
    </script>
  </body>
</html>
